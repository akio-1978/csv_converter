# toj2
このツールはまだ内部向けのものであり、ドキュメントは最小限しか用意されていません。

- コマンドラインからjinja2を実行し、テンプレートによる行うツールです。
  - 対応するファイル形式が特徴で、現在以下のファイル形式に対応しています。
    - csv/tsv
    - Excelブック
    - json

## 動作環境

python3.12 以上

## インストール

```sh
# masterブランチ
pip install git+https://github.com/akio-1978/toj2
# developブランチ（最新機能はこちら）
pip install git+https://github.com/akio-1978/toj2@develop
```

## コマンド構文
### データ種別ごとのサブコマンド
取扱うデータの種類によってサブコマンドに分かれます。以下に例を示します。

```
# csvファイルの場合
toj2 csv csvtemplate.tmpl data.csv -o rendered.txt

# excelファイルの場合
toj2 excel exceltemplate.tmpl data.xlsx 1 A1:D4 -o rendered.txt

# jsonファイルの場合
toj2 json jsontemplate.tmpl json.csv -o rendered.txt
```

オプションは全入力フォーマットに共通するものと、特定の入力フォーマットに固有のものがあります。

## 位置引数
コマンド先頭に指定されるコマンド引数です。ただし、excelファイルを扱う場合は別の形式になります。
### サブコマンド
上にも書いた通り、csv/excel/jsonのいずれかです。
### jinja2テンプレート
変換に使うjinja2テンプレートです。このテンプレートが配置された場所を起点として、他のテンプレートを`include`できます。
### 読込みファイル
変換元として読み込むファイルを指定します。省略した場合、`sys.stdin`からの読込みになります。**excelではファイル名は省略不可です。**

## 共通オプション引数
オプションで指定する引数です。
### 出力ファイル
`-o file`

変換結果を出力するファイルを指定します。省略された場合、`sys.stdout`に出力されます。

### 文字列エンコーディング

`--input-encoding enc`
`--output-encoding enc`

入出力ファイルのエンコーディングを指定します。デフォルトはUTF8です。**excelでは`--input-encoding`は無視されます。

### テンプレートパラメータ
jinja2テンプレートに任意の値を渡すことができます。値は`=`でキーと値に区切って指定します。指定できる数に制限はありません。

`--pamaeter PARAM1=A PARAM2=B `

この値は、テンプレート中で`param['PARAM1']`のようにして参照できます。

### 設定ファイル
引数に指定する値が多数に渡る場合は、jsonファイルに設定を記述することができます。
現バージョンでは、設定ファイル仕様はサンプルの提供のみで解説とします。

## CSV特有のオプション
CSVファイルを処理する場合、以下の特有のオプションがあります。
### デリミタ
ファイルがタブ文字などカンマ以外で区切られている場合、任意の文字を指定できます。タブ区切りの

`--delimiter "\t"`

### ヘッダ
1行目をヘッダ名として項目名に使用します。

`--header`

### 行スキップ
先頭から指定の行数を読み飛ばします。ヘッダのあるCSVに対してヘッダを無視する場合`--skip-lins 1`とします。

`--skip-lins 1`

### カラム名指定
jinja2テンプレートが受け取るカラムの名前を指定します。省略された場合、カラム名は左から順に`col00, col01...`と連番で自動生成されます。

`--names a b c`

この場合カラム名は`a, b, c`となり、3カラムを超える場合は`col03, col04`と自動生成されます。

1. アプリケーション全体の共通オプション
2. jinja2テンプレートの動作に影響を与えるもの
3. 扱うデータ形式に固有のもの

ここでは 1 および 2 の仕様について解説します

